<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoHunter Miner</title>
    <link rel="stylesheet" href="/webapp/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/webapp/script.js" defer></script>
</head>
<body>
    <div class="container">
        <!-- === ЗАГОЛОВОК === -->
        <div class="header">
            <h1>CryptoHunter</h1>
            <div class="language-switcher">
                <button id="lang-ru" class="lang-btn active" onclick="changeLanguage('ru')">RU</button>
                <button id="lang-en" class="lang-btn" onclick="changeLanguage('en')">ENG</button>
            </div>
        </div>

        <!-- === ГЛАВНЫЙ ЭКРАН === -->
        <div id="stats" class="section active">
            <img src="/webapp/assets/mining.gif" alt="Mining" class="mining-gif">
            
            <div class="top-actions">
                <button onclick="showSection('invest')" class="action-btn invest">
                    <img src="/webapp/assets/deposit.png" alt="Инвестировать" style="width:24px;height:24px;">
                    <span data-i18n="invest">Инвестировать</span>
                </button>
                <button onclick="showSection('withdraw')" class="action-btn withdraw">
                    <img src="/webapp/assets/withdraw.png" alt="Вывод" style="width:24px;height:24px;">
                    <span data-i18n="withdraw">Вывод</span>
                </button>
            </div>

            <div class="balance-card">
                <p data-i18n="your_balance">ВАШ БАЛАНС</p>
                <h2 id="balance">0.0000</h2>
                <p>TON</p>
            </div>

            <div class="stats-grid">
                <div class="stat"><p data-i18n="invested">Инвестировано</p><b id="invested">0.00</b></div>
                <div class="stat"><p data-i18n="earned">Заработано</p><b id="earned">0.0000</b></div>
                <div class="stat"><p data-i18n="speed">Скорость</p><b id="speed">100%</b></div>
            </div>

            <div class="nav-buttons">
                <button onclick="showSection('dashboard')" class="nav-btn">
                    <img src="/webapp/assets/stats.png" alt="Статистика" style="width:18px;height:18px;">
                    <span data-i18n="detailed_stats">Детальная статистика</span>
                </button>
                <button onclick="showSection('referral')" class="nav-btn">
                    <img src="/webapp/assets/referral.png" alt="Рефералы" style="width:18px;height:18px;">
                    <span data-i18n="referral_program">Реферальная программа</span>
                </button>
            </div>

            <button id="refresh-btn" class="btn big-btn" style="margin:20px auto;display:block;background:#4CAF50;" onclick="refresh()">
                <span data-i18n="refresh">Обновить</span>
            </button>
        </div>

        <!-- === ДЕТАЛЬНАЯ СТАТИСТИКА === -->
        <div id="dashboard" class="section">
            <div class="card">
                <h2 data-i18n="detailed_stats">Детальная статистика</h2>
                
                <div class="stats-section">
                    <h3 data-i18n="community">СООБЩЕСТВО</h3>
                    <div class="stat-row">
                        <span data-i18n="total_subscribers">Всего подписчиков:</span>
                        <b id="total-subscribers">0</b>
                    </div>
                    <div class="stat-row">
                        <span data-i18n="active_today">Активных сегодня:</span>
                        <b id="active-today">0</b>
                    </div>
                </div>

                <div class="stats-section">
                    <h3 data-i18n="investments">ИНВЕСТИЦИИ</h3>
                    <div class="stat-row"><span data-i18n="amount">Сумма:</span><b id="dash-invested">0.00 TON</b></div>
                    <div class="stat-row"><span data-i18n="day">День:</span><b id="dash-daily-inv">0.000 TON</b></div>
                    <div class="stat-row"><span data-i18n="week">Неделя:</span><b id="dash-weekly-inv">0.000 TON</b></div>
                    <div class="stat-row"><span data-i18n="month">Месяц:</span><b id="dash-monthly-inv">0.00 TON</b></div>
                </div>

                <div class="stats-section">
                    <h3 data-i18n="free_mining">БЕСПЛАТНЫЙ МАЙНИНГ</h3>
                    <div class="stat-row"><span data-i18n="speed">Скорость:</span><b id="dash-speed">100%</b></div>
                    <div class="stat-row"><span data-i18n="day">День:</span><b id="dash-daily-free">0.0000 TON</b></div>
                    <div class="stat-row"><span data-i18n="ton_per_days">1 TON за:</span><b id="dash-days-per-ton">0.0 дней</b></div>
                    <div class="stat-row"><span data-i18n="accumulated">Накоплено:</span><b id="dash-accumulated">0.00 TON</b></div>
                </div>

                <div class="stats-section">
                    <h3 data-i18n="currently_earning">СЕЙЧАС НАЧИСЛЯЕТСЯ</h3>
                    <div class="stat-row"><span data-i18n="per_day">В день:</span><b id="dash-total-daily">0.0000 TON</b></div>
                    <div class="stat-row"><span data-i18n="per_hour">В час:</span><b id="dash-hourly">0.0000 TON</b></div>
                </div>

                <!-- ТОП 10 ИНВЕСТОРОВ -->
                <div class="stats-section">
                    <h3 data-i18n="top_investors">ТОП 10 ИНВЕСТОРОВ</h3>
                    <div id="top-investors-list" class="list-box">
                        <div class="investor-row">
                            <div class="investor-rank">#1</div>
                            <div class="investor-name">CryptoWolf</div>
                            <div class="investor-amount">15,245.50 TON</div>
                            <div class="investor-change positive">↗ 2.3%</div>
                        </div>
                        <div class="investor-row">
                            <div class="investor-rank">#2</div>
                            <div class="investor-name">TONHunter</div>
                            <div class="investor-amount">12,890.25 TON</div>
                            <div class="investor-change positive">↗ 1.8%</div>
                        </div>
                        <div class="investor-row">
                            <div class="investor-rank">#3</div>
                            <div class="investor-name">BlockShark</div>
                            <div class="investor-amount">11,567.80 TON</div>
                            <div class="investor-change negative">↘ 0.5%</div>
                        </div>
                        <div class="investor-row">
                            <div class="investor-rank">#4</div>
                            <div class="investor-name">Moonrider</div>
                            <div class="investor-amount">8,945.30 TON</div>
                            <div class="investor-change positive">↗ 3.1%</div>
                        </div>
                        <div class="investor-row">
                            <div class="investor-rank">#5</div>
                            <div class="investor-name">Tonik</div>
                            <div class="investor-amount">7,234.15 TON</div>
                            <div class="investor-change positive">↗ 1.2%</div>
                        </div>
                    </div>
                </div>

                <!-- ЗАЯВКИ НА ВЫВОД -->
                <div class="stats-section">
                    <h3 data-i18n="withdraw_requests">ЗАЯВКИ НА ВЫВОД</h3>
                    <div id="withdraw-requests-list" class="list-box">
                        <div class="withdraw-row completed">
                            <div class="withdraw-user">Andrey</div>
                            <div class="withdraw-amount">125.50 TON</div>
                            <div class="withdraw-address">kQ1234...abcd</div>
                            <div class="withdraw-status completed">Выполнен</div>
                            <div class="withdraw-time">2ч 15м назад</div>
                        </div>
                        <div class="withdraw-row processing">
                            <div class="withdraw-user">Ivan</div>
                            <div class="withdraw-amount">89.75 TON</div>
                            <div class="withdraw-address">UQ5678...efgh</div>
                            <div class="withdraw-status processing">В процессе</div>
                            <div class="withdraw-time">45м назад</div>
                        </div>
                        <div class="withdraw-row pending">
                            <div class="withdraw-user">Anna</div>
                            <div class="withdraw-amount">234.20 TON</div>
                            <div class="withdraw-address">EQ9012...ijkl</div>
                            <div class="withdraw-status pending">Ожидание</div>
                            <div class="withdraw-time">15м назад</div>
                        </div>
                        <div class="withdraw-row completed">
                            <div class="withdraw-user">Sergey</div>
                            <div class="withdraw-amount">67.80 TON</div>
                            <div class="withdraw-address">kQ3456...mnop</div>
                            <div class="withdraw-status completed">Выполнен</div>
                            <div class="withdraw-time">5ч 30м назад</div>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <h3>Вывод</h3>
                    <div class="stat-row"><span id="dash-withdraw-status">- <span data-i18n="not_ready">Не готово</span></span></div>
                    <div class="stat-row"><span id="dash-min-withdraw" data-i18n="min_withdraw">Минимум: 1 TON (1.00 TON осталось)</span></div>
                </div>
            </div>
            <button onclick="showSection('stats')" class="btn back" data-i18n="back">Назад</button>
        </div>

        <!-- === РЕФЕРАЛЫ === -->
        <div id="referral" class="section">
            <div class="card">
                <h2 data-i18n="referral_program">Реферальная программа</h2>
                
                <div class="ref-stats">
                    <div class="ref-stat">
                        <div class="ref-stat-value" id="ref-direct">0</div>
                        <div class="ref-stat-label" data-i18n="direct_referrals">прямых рефералов</div>
                    </div>
                    <div class="ref-stat">
                        <div class="ref-stat-value" id="ref-level2">0</div>
                        <div class="ref-stat-label" data-i18n="level_2">2-й уровень</div>
                    </div>
                    <div class="ref-stat">
                        <div class="ref-stat-value" id="ref-income">0.00</div>
                        <div class="ref-stat-label" data-i18n="earned_ton">Заработано TON</div>
                    </div>
                </div>

                <div class="ref-link-container">
                    <p data-i18n="your_referral_link">Ваша реферальная ссылка:</p>
                    <div class="ref-link-box" id="ref-link">https://t.me/cruptos023bot?start=ref_123</div>
                    <button onclick="copyLink()" class="btn copy-btn" data-i18n="copy_link">Скопировать ссылку</button>
                </div>
            </div>
            <button onclick="showSection('stats')" class="btn back" data-i18n="back">Назад</button>
        </div>

        <!-- === ИНВЕСТ + КАЛЬКУЛЯТОР === -->
        <div id="invest" class="section">
            <div class="card">
                <h2 data-i18n="investing">Инвестирование</h2>
                
                <!-- КАЛЬКУЛЯТОР ДОХОДНОСТИ -->
                <div class="calculator-section" style="margin-bottom: 25px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; color: white;">
                    <h3 style="margin: 0 0 15px 0; text-align: center;" data-i18n="profit_calculator">Калькулятор доходности</h3>
                    
                    <div class="input-group" style="margin-bottom: 15px;">
                        <label style="color: white;" data-i18n="investment_amount">Сумма инвестиции (TON):</label>
                        <input type="number" id="calc-amount" class="input-field" 
                               placeholder="Введите сумму" min="1" value="10" 
                               style="background: rgba(255,255,255,0.9); color: #333;"
                               oninput="calculateProfit()">
                    </div>
                    
                    <div class="calculator-results" style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 12px; backdrop-filter: blur(10px);">
                        <div class="calc-result-row">
                            <span data-i18n="daily_income">Доход в день:</span>
                            <b id="calc-daily">0.0000 TON</b>
                        </div>
                        <div class="calc-result-row">
                            <span data-i18n="weekly_income">Доход в неделю:</span>
                            <b id="calc-weekly">0.0000 TON</b>
                        </div>
                        <div class="calc-result-row">
                            <span data-i18n="monthly_income">Доход в месяц:</span>
                            <b id="calc-monthly">0.0000 TON</b>
                        </div>
                        <div class="calc-result-row">
                            <span data-i18n="yearly_income">Доход в год:</span>
                            <b id="calc-yearly">0.0000 TON</b>
                        </div>
                        <div class="calc-result-row" style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px; margin-top: 10px;">
                            <span data-i18n="welcome_bonus">Приветственный бонус:</span>
                            <b id="calc-bonus" style="color: #4CAF50;">+0.00 TON</b>
                        </div>
                    </div>
                </div>

                <!-- ФОРМА ИНВЕСТИРОВАНИЯ -->
                <div class="input-group">
                    <label data-i18n="investment_amount">Сумма инвестиции (TON):</label>
                    <input type="number" id="invest-amount" class="input-field" placeholder="Минимум 1 TON" min="1">
                </div>

                <button onclick="createDeposit()" class="btn big-btn">Сгенерировать QR для оплаты</button>

                <div id="qr-section" style="display:none;text-align:center;margin-top:20px;">
                    <p data-i18n="scan_qr">Отсканируйте QR-код для оплаты:</p>
                    <img id="qr-img" alt="QR Code" width="220" style="border:1px solid #ccc;border-radius:12px;padding:6px;">
                    <p data-i18n="ton_address">Адрес TON:</p>
                    <p id="qr-address" style="word-break:break-all;">—</p>
                    <p><span data-i18n="comment">Комментарий:</span> <span id="qr-comment">—</span></p>
                    <a id="payment-url" href="#" target="_blank" style="color:#2196F3;">Открыть в кошельке</a>
                    <div style="margin-top: 15px;">
                        <button onclick="copyAddress()" class="btn" style="margin:5px;">Скопировать адрес</button>
                        <button onclick="copyPaymentUrl()" class="btn" style="margin:5px;">Скопировать ссылку</button>
                    </div>
                </div>
            </div>
            <button onclick="showSection('stats')" class="btn back" data-i18n="back">Назад</button>
        </div>

        <!-- === ВЫВОД === -->
        <div id="withdraw" class="section">
            <div class="card">
                <h2 data-i18n="withdraw_funds">Вывод средств</h2>
                
                <p data-i18n="available_for_withdraw">Доступно: <b id="withdraw-available">0.0000</b> TON</p>
                
                <div class="input-group">
                    <label data-i18n="ton_wallet_address">Адрес TON кошелька:</label>
                    <input type="text" id="withdraw-address" class="input-field" placeholder="Начинается с kQ, UQ или EQ">
                </div>
                
                <div class="input-group">
                    <label data-i18n="withdraw_amount">Сумма вывода (TON):</label>
                    <input type="number" id="withdraw-amount" class="input-field" placeholder="Минимум 1 TON" min="1">
                </div>

                <button onclick="withdraw()" class="btn big-btn">Вывести средства</button>
                
                <div id="withdraw-status" class="status-message"></div>
            </div>
            <button onclick="showSection('stats')" class="btn back" data-i18n="back">Назад</button>
        </div>
    </div>

    <!-- === УВЕДОМЛЕНИЯ === -->
    <div id="notification" class="notification"></div>

    <!-- === ВСТРОЕННЫЙ КАЛЬКУЛЯТОР (локальный) === -->
    <script>
        function calculateProfit() {
            const input = document.getElementById('calc-amount');
            const amount = parseFloat(input?.value) || 0;

            const results = {
                daily: 0,
                weekly: 0,
                monthly: 0,
                yearly: 0,
                bonus: 0
            };

            if (amount >= 1) {
                const MONTHLY_RATE = 0.25;
                const BASE_MINING_DAYS = 90;
                const BONUS_PERCENT = 0.05;

                // Инвестиционный доход в день
                const investmentDaily = amount * (MONTHLY_RATE / 30);

                // Ускорение майнинга: +1% за каждые 40 TON
                const acceleration = Math.floor(amount / 40) * 0.01;
                const miningSpeed = 1 + acceleration;

                // Бесплатный майнинг в день
                const freeMiningDaily = (1 / BASE_MINING_DAYS) * miningSpeed;

                // Общий доход
                const totalDaily = investmentDaily + freeMiningDaily;
                const bonus = amount * BONUS_PERCENT;

                results.daily = totalDaily;
                results.weekly = totalDaily * 7;
                results.monthly = totalDaily * 30;
                results.yearly = totalDaily * 365;
                results.bonus = bonus;
            }

            // Обновление интерфейса
            const set = (id, value, fixed = 4) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value.toFixed(fixed) + ' TON';
            };

            set('calc-daily', results.daily, 6);
            set('calc-weekly', results.weekly, 6);
            set('calc-monthly', results.monthly, 4);
            set('calc-yearly', results.yearly, 2);
            document.getElementById('calc-bonus').textContent = '+' + results.bonus.toFixed(2) + ' TON';
        }

        // Запуск расчёта при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            if (document.getElementById('calc-amount')) {
                calculateProfit();
            }
        });
    </script>
</body>
</html>
